:icons: font

= Spring-Boot-Angular-Template image:https://travis-ci.com/mrrobworks/spring-boot-angular-template.svg?branch=master["Build Status", link="https://travis-ci.com/mrrobworks/spring-boot-angular-template"]

Template to create a OAuth2 secured dockerized Spring Boot Application with Angular Frontend.
A user with a Google- or Github-Account get access to the Application using OAuth2-Authentication, so
no additional User Registration is required. A new user get the Default-Role _ROLE_USER_. Additional Roles,
like _ROLE_ADMIN_ for administrative access, can be assigned to a user through the Role-Management.
The data get stored in a PostgreSQL database inside a Docker-Container.

.Login-Screen
image:https://user-images.githubusercontent.com/37511144/54868460-edafea80-4d8c-11e9-829a-92912f192c29.png[spring-boot-angular-login]

== Technology-Stack image:http://img.shields.io/badge/tech-stack-0690fa.svg?style=flat["StackShare", link="https://stackshare.io/mrrobworks/spring-boot-angular-template-stack"]
image:https://user-images.githubusercontent.com/37511144/55079435-733cde80-509c-11e9-80ff-f3d4e093dbd4.png[spring-boot-angular-template-stack]

Need to be installed on the OS to startup the application:

* :whale: https://www.docker.com/get-started[Docker]

Need to be installed on the OS for development purposes:

* https://git-scm.com/downloads[Git]
* :coffee:  https://www.oracle.com/technetwork/java/javase/downloads/jdk11-downloads-5066655.html[JDK 11]
* https://maven.apache.org/download.cgi[Maven]
* :hot_pepper: https://projectlombok.org/download[Lombok]
* https://nodejs.org/en/[Node.js]
* https://cli.angular.io/[Angular-CLI]

== Getting Started
To get the application running, some configuration need to be to do.

=== Prerequisites
*Step 1:* Install  https://www.docker.com/get-started[Docker] on your OS. This is necessary to running the command
`docker-compose` in a terminal.

*Step 2:* After Docker is installed, go to the Docker-Settings and share the drive in which you will later download the
http://???[latest Release] of the Spring-Boot-Angular-Template.

image:https://user-images.githubusercontent.com/37511144/56428525-fcbc8680-62bf-11e9-9299-8782ad98bac9.png[docker-share]

This is necessary for accessing the SQL-Files for setting up the database.

=== Obtaining API-Keys

To use the O2Auth-Authentication from Google or Github, we need to register this application to obtain the appropiate
Client-ID and Client-Secret.

'''

image:https://user-images.githubusercontent.com/37511144/55681624-ab5be100-5928-11e9-82bf-e5e352485c17.png[google,width=250]

*Step 1:* Open a webbrowser and go to https://cloud.google.com/console/project[Google Cloud Console]

*Step 2:* Click on the Button `Create Project`

*Step 3:* In the following `New Project`-Dialog set following:

image:https://user-images.githubusercontent.com/37511144/56429206-676ec180-62c2-11e9-8d9d-bd04703aefd4.png[new-project-dialog]

After that Click on the `Create`-Button

*Step 4:* On the top left click on the Button with the three stripes to open the left-side Navigation-Menu. Select
`APIs & Services` -> `Credentials`

*Step 5:* In the Credentials-View click on the Button `Create credentials` and than select the Menu-Item `OAuth client ID`.

*Step 6:* In the Create OAuth client ID Dialaog Type type in following:

image:https://user-images.githubusercontent.com/37511144/55275019-eb471680-52df-11e9-85c3-a7e549762505.png[create oauth client id]

After that click on the `Create`-Button

*Step 7:* A dialog appears with a generated `client ID` and `client secret` which you need to copy for later usage.

'''

image:https://user-images.githubusercontent.com/37511144/55681693-96cc1880-5929-11e9-980e-986a753386ae.png[github,width=250]

*Step 1:* In your webbrowser go to https://github.com/settings/profile[Account Settings]

*Step 2:* Press on the left navigation side menu the Menu-Item `Developer-Settings`

*Step 3:* Select on the left navigation side menu `OAuth Apps` and click on the Button `Register a new application`.

*Step 4:* In the _Register a new OAuth application_ dialog type in following:

image:https://user-images.githubusercontent.com/37511144/54868432-bb9e8880-4d8c-11e9-926f-fbca57e7f8dd.png[github-register-oauth]

Click than on the button `Register application`

*Step 5:* Copy your generated `Client ID` and `Client Secret`

NOTE: Unfortunately github is not allowing adding more than one _Homepage URL_ and _Authorization callback URL_.
So for development purposes using the Google-OAuth2 should be prefered.

=== Installing

*Step 1:* Download the https://github.com/mrrobworks/spring-boot-angular-template/releases/download/v0.1/spring-boot-angular-template.tar.gz[lastest Release]
to your working-directory and unzip the file with following commands:

```bash
$ wget https://github.com/mrrobworks/spring-boot-angular-template/releases/download/v0.1/spring-boot-angular-template.tar.gz
$ tar -xvzf spring-boot-angular-template.tar.gz
$ cd spring-boot-angular-template
```

*Step 3:* Load the docker-image to your local repository with:

```bash
docker load < spring-boot-angular-template-docker-image.tar
```

*Step 4:* In the file `docker-compose.ref.yml` change following
```
GOOGLE_CLIENT_ID: [google-client-id]
GOOGLE_CLIENT_SECRET: [google-client-secret]
GITHUB_CLIENT_ID: [github-client-id]
GITHUB_CLIENT_SECRET: [github-client-secret]
```

Replace `[google-client-id]`, `[google-client-secret]`, `[github-client-id]`, `[github-client-secret]` with your copied
values.

=== Run the application

Now you can simply run the application with following steps:

*Step 1:* In the project-root directory type following:
```bash
$  docker-compose -f docker-compose.yml -f docker-compose.ref.yml up
```

*Step 2:* In your Webbrowser type `http://localhost:8091` and the webapplication shows up.

=== Development

For the Development some Prerequisites are recommended:

*Step 1:* For executing commands we need a terminal. If you are running a bash-shell on a Linux-Distrubtion
or Mac-OS everything should be fine. The Windows _Powershell_ and _CMD_ could make some problems and
the build-process fails. My recommendation is to install the
https://docs.microsoft.com/de-de/windows/wsl/install-win10[Windows Subsystem for Linux (WSL)]
in Windows 10 and using the bash-shell from it.

*Step 2:* If you are running Windows 10 and using WSL with a terminal, then follow the instructions described in
this https://nickjanetakis.com/blog/setting-up-docker-for-windows-and-wsl-to-work-flawlessly[Blog-Post].

For Development some additional software need to be installed.

*Step 1:*  Install https://www.oracle.com/technetwork/java/javase/downloads/jdk11-downloads-5066655.html[JDK 11],
https://maven.apache.org/download.cgi[Maven] and https://nodejs.org/en/[Node.js] on your OS.

*Step 2:* Open a terminal and type
```bash
$ npm install -g @angular/cli
```
to install the https://cli.angular.io/[Angular-CLI]

*Step 3:* Open your IDE and install https://projectlombok.org/download[Lombok] as a Plugin.

To start the PostgreSQL database in a Docker-Container, open a terminal, change the location to
the project-root directory and type following:
```bash
$  docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
```

If you develop with https://www.jetbrains.com/idea/[IntelliJ IDEA] there are also some
https://github.com/mrrobworks/spring-boot-angular-template/tree/master/.idea/runConfigurations[Run-Configurations]
in the Project-Repository. Start the Run-Configurations _docker-compose-DEV_, _backend-spring-boot-DEV_
and _frontend-angular-DEV_ in IntellJ and you are ready to go. Open a webbrowser, type `http://localhost:4200`
and the webapplication shows up.

*Step 1:* Open a terminal and type:
```bash
$ git clone https://github.com/mrrobworks/spring-boot-angular-template.git
$ cd spring-boot-angular-template
```

*Step 2:* Install the application with the command:
```bash
$ ./mvnw clean install
```

Replace `[google-client-id]`, `[google-client-secret]`, `[github-client-id]`, `[github-client-secret]` with your copied
values.

=== Troubleshooting

*Trouble 1:* When installing the application with `./mvnw clean install` and you getting a error like this:
```
[ERROR] Get https://registry-1.docker.io/v2/: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)
[WARNING] An attempt failed, will retry 1 more times
org.apache.maven.plugin.MojoExecutionException: Could not build image
```
then restart the Docker deamon and the error should be gone.

*Trouble 2:* Using CMD or Powershell in Windows and install the application with `mvnw.cmd clean install` it
appears following:

```
[INFO] > cd bin && ng build --prod
[INFO]
[ERROR] 'ng' is not recognized as an internal or external command,
[ERROR] operable program or batch file.
```

This is usually a problem when installing the application with CMD or Powershell. The command `ng`
from the Angular-CLI is not recognized correctly. You need to install _Node.js_ and _Angular-CLI_
and then set the corresponding Windows-Evironment-Path variables. Also you can change in `frontend/package.json`
the following:

```
"scripts": {
    "ng": "ng",
    "start": "ng serve --proxy-config proxy.conf.json",
    "build": "ng build --prod",
    "test": "ng test",
    "lint": "ng lint",
    "e2e": "ng e2e"
  }
```
== TODOs
- [ ] Fix .gitignore-File
- [ ] Using var for local-variables
- [ ] WebMvcTest for REST-Controller (mockMvc)
- [ ] Add Swagger Documentation for REST-Controllers
- [ ] Add Mockito Tests
- [ ] Redesign Angular-Frontend CSS
- [ ] Review Code in Frontend
- [ ] Replace some components in frontend (Checkbox)
- [ ] Using EntityGraph for JPA (instead FetchType.EAGER)?
- [ ] Swagger with OAuth2 or BasicAuth?
- [ ] DB-Setup in backend or module dbsetup?
- [ ] Add spring-boot-devtools?
- [ ] Create ViewModel-Beans for each JPA-Model-Entity-Bean?
- [ ] Microservices from this project for creating github-repositories
- [x] Changing return types of REST-Controllers to ResponseEntity
- [x] User-Roles Access on custom sites / elements
- [x] Angular / CSS / Bootstrap (Angular-Material implemented)
- [x] Profile in OAuthSecurityConfiguration (Google, Github)
- [x] User-Role-assignment through webapplication
- [x] Save LoggedIn User to Session
- [x] CRUD Roles for Administrator of the Application
- [x] Building Docker-Image with Spring-Boot and Angular
- [x] Create schema.sql and data.sql for script based data initialization
- [x] Validation Rules in backend-model classes (Java Bean Validation API, JSR-303)
- [x] application.properties change to application.yml
- [x] Update README.md with actual installation instructions for development and how to setup Intellij / Docker.
- [x] application-external.properties to yml and add installation instructions to README.md
- [x] Login-Site Radio-Button Google and Github link to /login and /login/github
